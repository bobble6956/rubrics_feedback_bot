<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Feedback Demo</title>
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 20px; background: #f9f9f9; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h2 { border-bottom: 2px solid #eee; padding-bottom: 10px; }
        input, textarea { width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 4px; }
        textarea { height: 200px; font-family: monospace; }
        button { background: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background: #0056b3; }
        button:disabled { background: #aaa; }

        /* NEW: Styling for the rendered Markdown output */
        #results {
            background: #fdfdfd;
            border: 1px solid #eee;
            padding: 10px 20px;
            margin-top: 20px;
            border-radius: 4px;
            line-height: 1.6;
            font-family: Georgia, 'Times New Roman', Times, serif;
        }
        #results.loading {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: #888;
        }
        #results table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        #results th, #results td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        #results th {
            background-color: #f2f2f2;
        }
        #results h3 {
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        #results strong {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Submit Your Essay</h2>
        
        <label for="firstName">First Name (try "Jane")</label>
        <input type="text" id="firstName" value="Jane">
        
        <label for="lastName">Last Name (try "Doe")</label>
        <input type="text" id="lastName" value="Doe">
        
        <label for="essayText">Essay Text (try pasting an essay about "To Kill a Mockingbird" or "The Great Gatsby")</label>
        <textarea id="essayText">Jay Gatsby's pursuit of the American Dream was ultimately a failure. His dream, symbolized by the green light, was based on recapturing the past with Daisy. This proved to be an illusion, as Daisy was part of the "old money" elite who were careless and destructive. My thesis is that the novel shows the dream is corrupt.</textarea>
        
        <button id="submitBtn" onclick="submitEssay()">Get AI Feedback</button>
        
        <h3>Results</h3>
        <div id="results">Your feedback will appear here...</div>
    </div>

    <script>
        async function submitEssay() {
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const essayText = document.getElementById('essayText').value;
            const resultsEl = document.getElementById('results');
            const submitBtn = document.getElementById('submitBtn');

            resultsEl.textContent = 'Loading... Calling Gemini 2.5 Flash, Vertex AI Search, and Gemini 2.5 Pro...';
            resultsEl.classList.add('loading');
            submitBtn.disabled = true;

            try {
                const response = await fetch('/grade', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ firstName, lastName, essayText })
                });
                
                const results = await response.json();
                
                // --- NEW: Render the Markdown! ---
                // We get the final text from the 'feedback_text' field...
                // and use marked.parse() to turn it into HTML.
                if (results.feedback_text) {
                    resultsEl.innerHTML = marked.parse(results.feedback_text);
                } else {
                    resultsEl.textContent = "An error occurred. No feedback text was returned."
                }
                // --- End of new logic ---

            } catch (error) {
                console.error("Error fetching feedback:", error);
                resultsEl.textContent = "An error occurred while connecting to the backend. Check the console.";
            } finally {
                resultsEl.classList.remove('loading');
                submitBtn.disabled = false;
            }
        }
    </script>
</body>
</html>